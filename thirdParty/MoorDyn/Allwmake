#!/bin/sh
cd ${0%/*} || exit 1    # run from this directory

# Stop if something fails
set -e

# compile the 3rd parties (modules)
# =======================
git submodule init
git submodule update --remote

echo "=========================================="
echo "    COMPILE Thirdparty lib - MoorDynv1    "
echo "=========================================="
# compile MoorDyn v1
echo "compile MoorDyn v1"
cd MoorDyn_v1/compileSO/; 
make 
mv MoorDyn.so $FOAM_USER_LIBBIN/libmoorDyn.so
echo "Compilation done! Library location:"
echo "$FOAM_USER_LIBBIN/libmoorDyn.so"
cd ../../

#echo "==============================================="
#echo "    COMPILE MoorDyn-FloatStepper extension     "
#echo "==============================================="
#wmake src

echo "=========================================="
echo "    COMPILE Thirdparty lib - MoorDynv2    "
echo "=========================================="
echo "compiling MoorDyn v2..."
mkdir -p MoorDyn.build
cd MoorDyn.build
cmake -DBUILD_TESTING=OFF -DEXTERNAL_EIGEN=OFF -DFORTRAN_WRAPPER=OFF -DMATLAB_WRAPPER=OFF -DPYTHON_WRAPPER=OFF -DUSE_VTK=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=$FOAM_USER_LIBBIN/.. ../MoorDyn
CMAKE_RESULT=$?
make -j
make install
cd ..
pwd

echo "==============================================="
echo "    COMPILE MoorDyn-FloatStepper extension     "
echo "==============================================="
echo "compile FloatStepper mooring restraints"
(cd src && wmake libso )
#wmake src

echo "Compilation done!"
